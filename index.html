<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Black Store - Nitro Checker Fixed</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <style>
        :root {
            --apple-blue: #007aff;
            --apple-green: #34c759;
            --apple-red: #ff3b30;
            --apple-yellow: #ffbd2e;
            --font-main: 'Inter', -apple-system, sans-serif;
            --font-mono: 'JetBrains Mono', monospace;
            --glass-bg: rgba(25, 25, 25, 0.8);
            --glass-border: rgba(255, 255, 255, 0.15);
        }

        * { box-sizing: border-box; margin: 0; padding: 0; user-select: none; -webkit-font-smoothing: antialiased; }
        body {
            height: 100vh;
            width: 100vw;
            background: url('https://i.pinimg.com/736x/8b/31/7d/8b317dab27e19adc191397589af6d86e.jpg') no-repeat center center;
            background-size: cover;
            font-family: var(--font-main);
            overflow: hidden;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        .window {
            width: 92%;
            max-width: 1100px;
            height: 80vh;
            background: var(--glass-bg);
            backdrop-filter: blur(40px);
            border-radius: 14px;
            box-shadow: 0 50px 100px rgba(0,0,0,0.6);
            display: flex;
            flex-direction: column;
            border: 1px solid var(--glass-border);
            overflow: hidden;
            z-index: 10;
            transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .window-header {
            height: 44px;
            background: rgba(255, 255, 255, 0.05);
            display: flex;
            align-items: center;
            padding: 0 18px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.08);
        }
        .controls { display: flex; gap: 9px; }
        .dot { width: 12px; height: 12px; border-radius: 50%; cursor: pointer; }
        .dot-red { background: var(--apple-red); }
        .dot-yellow { background: var(--apple-yellow); }
        .dot-green { background: var(--apple-green); }
        .window-title { flex: 1; text-align: center; font-size: 13px; font-weight: 600; color: rgba(255,255,255,0.6); margin-right: 45px; }
        .content { flex: 1; display: flex; overflow: hidden; }
        .sidebar {
            width: 280px;
            background: rgba(0, 0, 0, 0.2);
            padding: 25px;
            display: flex;
            flex-direction: column;
            gap: 20px;
            border-right: 1px solid rgba(255, 255, 255, 0.05);
        }
        .label { font-size: 11px; font-weight: 700; color: rgba(255,255,255,0.3); text-transform: uppercase; letter-spacing: 1px; }
        textarea {
            width: 100%;
            height: 180px;
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            color: var(--apple-green);
            padding: 15px;
            font-family: var(--font-mono);
            font-size: 13px;
            resize: none;
            outline: none;
        }
        .btn {
            width: 100%;
            padding: 12px;
            border-radius: 10px;
            border: none;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        .btn-blue { background: var(--apple-blue); color: white; }
        .btn-gray { background: rgba(255, 255, 255, 0.1); color: white; }
        .terminal-container { flex: 1; display: flex; flex-direction: column; background: rgba(0, 0, 0, 0.1); }
        .terminal { flex: 1; padding: 30px; font-family: var(--font-mono); font-size: 14px; color: #fff; overflow-y: auto; line-height: 1.8; }
        .log-line { margin-bottom: 10px; display: flex; align-items: flex-start; gap: 15px; }
        .status-icon { width: 20px; height: 20px; flex-shrink: 0; margin-top: 2px; }
        .footer {
            height: 48px;
            background: rgba(0, 0, 0, 0.2);
            border-top: 1px solid rgba(255, 255, 255, 0.05);
            display: flex;
            align-items: center;
            padding: 0 30px;
            gap: 35px;
            font-size: 12px;
            font-weight: 600;
            color: rgba(255,255,255,0.5);
        }
        .stat-val { color: #fff; margin-left: 6px; font-size: 14px; }
        .dock-wrapper { position: absolute; bottom: 20px; left: 50%; transform: translateX(-50%); z-index: 2000; }
        .dock {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(40px);
            padding: 10px 18px;
            border-radius: 24px;
            display: flex;
            gap: 20px;
            align-items: center;
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 20px 50px rgba(0,0,0,0.4);
        }
        .dock-icon { width: 54px; height: 54px; cursor: pointer; transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); position: relative; }
        .dock-icon:hover { transform: scale(1.3) translateY(-15px); }
        .dock-icon img { width: 100%; height: 100%; object-fit: contain; }
        .dock-icon.active::after {
            content: ''; position: absolute; bottom: -8px; left: 50%; transform: translateX(-50%);
            width: 4px; height: 4px; background: white; border-radius: 50%;
        }
        @media (max-width: 768px) {
            .window { width: 100%; height: 100%; border-radius: 0; }
            .controls { display: none; }
            .content { flex-direction: column; }
            .sidebar { width: 100%; height: auto; }
            textarea { height: 100px; }
        }
        ::-webkit-scrollbar { width: 4px; }
        ::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.2); border-radius: 10px; }
    </style>
</head>
<body>
<div class="window" id="mainWindow">
    <div class="window-header">
        <div class="controls">
            <div class="dot dot-red" onclick="closeWindow()"></div>
            <div class="dot dot-yellow"></div>
            <div class="dot dot-green"></div>
        </div>
        <div class="window-title">Black Store - Checker (Fixed)</div>
    </div>
    <div class="content">
        <div class="sidebar">
            <span class="label">Input Links</span>
            <textarea id="linksInput" placeholder="Cole os links ou códigos aqui..."></textarea>
            <button class="btn btn-blue" id="startBtn" onclick="startChecker()">começar</button>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                <button class="btn btn-gray" onclick="copyValids()" style="font-size: 11px;">copiar</button>
                <button class="btn btn-gray" onclick="downloadValids()" style="font-size: 11px;">baixar</button>
            </div>
            <button class="btn btn-gray" onclick="document.getElementById('fileInput').click()" style="font-size: 11px;">Import .txt</button>
            <input type="file" id="fileInput" style="display: none;" onchange="handleFile(event)">
        </div>
        <div class="terminal-container">
            <div class="terminal" id="terminal">
                <div style="color: var(--apple-blue); font-weight: bold; margin-bottom: 15px;">[SISTEMA] PRONTO PARA USO.</div>
            </div>
            <div class="footer">
                <div class="stat-item">TOTAL <span class="stat-val" id="stat-total">0</span></div>
                <div class="stat-item" style="color: var(--apple-green);">VALIDOS <span class="stat-val" id="stat-valid">0</span></div>
                <div class="stat-item" style="color: var(--apple-red);">INVALIDOS <span class="stat-val" id="stat-invalid">0</span></div>
            </div>
        </div>
    </div>
</div>
<div class="dock-wrapper">
    <div class="dock">
        <div class="dock-icon active" id="dock-checker" onclick="openWindow()">
            <img src="https://cdn-icons-png.flaticon.com/512/5968/5968756.png" alt="Nitro Checker">
        </div>
        <div class="dock-icon" onclick="closeWindow()">
            <img src="https://cdn-icons-png.flaticon.com/512/3221/3221803.png" alt="Trash">
        </div>
    </div>
</div>

<script>
    const CONFIG = {
        delay: 1500 // Aumentado levemente para evitar rate limit rápido
    };
    
    let stats = { total: 0, checked: 0, valid: 0, invalid: 0, isRunning: false, validLinks: [] };
    
    const ICONS = {
        valid: `<svg class="status-icon" viewBox="0 0 24 24" fill="none" stroke="var(--apple-green)" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"></polyline></svg>`,
        invalid: `<svg class="status-icon" viewBox="0 0 24 24" fill="none" stroke="var(--apple-red)" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>`,
        info: `<svg class="status-icon" viewBox="0 0 24 24" fill="none" stroke="var(--apple-blue)" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="16" x2="12" y2="12"></line><line x1="12" y1="8" x2="12.01" y2="8"></line></svg>`,
        warning: `<svg class="status-icon" viewBox="0 0 24 24" fill="none" stroke="var(--apple-yellow)" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path><line x1="12" y1="9" x2="12" y2="13"></line><line x1="12" y1="17" x2="12.01" y2="17"></line></svg>`
    };

    function addLog(msg, type = 'info') {
        const terminal = document.getElementById('terminal');
        const div = document.createElement('div');
        div.className = 'log-line';
        const color = type === 'valid' ? 'var(--apple-green)' : type === 'invalid' ? 'var(--apple-red)' : type === 'warning' ? 'var(--apple-yellow)' : '#fff';
        div.innerHTML = `<div class="status-icon">${ICONS[type] || ICONS.info}</div><div style="color: ${color}">${msg}</div>`;
        terminal.appendChild(div);
        terminal.scrollTop = terminal.scrollHeight;
    }

    async function checkNitro(code) {
        // Removido o token de autorização pois não é necessário para gift codes públicos
        const url = `https://discord.com/api/v9/entitlements/gift-codes/${code}?with_application=false&with_subscription_plan=true`;
        try {
            const response = await fetch(url, { 
                method: 'GET', 
                headers: { 'Accept': '*/*' } 
            });
            
            if (response.status === 200) {
                const data = await response.json();
                if (data.uses < data.max_uses) {
                    return 'VALID';
                } else {
                    return 'CLAIMED';
                }
            } else if (response.status === 404) {
                return 'INVALID';
            } else if (response.status === 429) {
                return 'RATE_LIMIT';
            } else {
                return 'ERROR';
            }
        } catch (err) {
            return 'CORS_ERROR';
        }
    }

    async function startChecker() {
        const input = document.getElementById('linksInput').value.trim();
        let links = input.split('\n').map(l => l.trim()).filter(Boolean);
        if (links.length === 0) return;

        stats.total = links.length; stats.checked = 0; stats.valid = 0; stats.invalid = 0; stats.validLinks = [];
        stats.isRunning = true;
        updateStats();
        document.getElementById('startBtn').disabled = true;
        addLog(`Iniciando verificação de ${links.length} links...`, "info");

        for (let link of links) {
            if (!stats.isRunning) break;

            // Extrair apenas o código do link (suporta discord.gift/, discordapp.com/gifts/, etc)
            let code = link;
            if (link.includes('/')) {
                code = link.split('/').pop().split('?')[0];
            }

            const result = await checkNitro(code);

            if (result === 'VALID') {
                stats.valid++; 
                stats.validLinks.push(link);
                addLog(`VÁLIDO: ${link}`, "valid");
            } else if (result === 'CLAIMED') {
                stats.invalid++;
                addLog(`RESGATADO: ${link}`, "warning");
            } else if (result === 'INVALID') {
                stats.invalid++;
                addLog(`INVÁLIDO: ${link}`, "invalid");
            } else if (result === 'RATE_LIMIT') {
                addLog("Rate Limit! Aguardando 10 segundos...", "warning");
                await new Promise(r => setTimeout(r, 10000));
                // Tentar novamente o mesmo link
                links.unshift(link);
                continue;
            } else if (result === 'CORS_ERROR') {
                addLog("Erro de CORS! Certifique-se de estar usando uma extensão para ignorar CORS.", "invalid");
                stats.isRunning = false;
                break;
            } else {
                stats.invalid++;
                addLog(`ERRO DESCONHECIDO: ${link}`, "invalid");
            }

            stats.checked++;
            updateStats();
            await new Promise(r => setTimeout(r, CONFIG.delay));
        }

        stats.isRunning = false;
        document.getElementById('startBtn').disabled = false;
        addLog("Verificação finalizada.", "info");
    }

    function updateStats() {
        document.getElementById('stat-total').textContent = stats.total;
        document.getElementById('stat-valid').textContent = stats.valid;
        document.getElementById('stat-invalid').textContent = stats.invalid;
    }

    function closeWindow() { document.getElementById('mainWindow').style.display = 'none'; document.getElementById('dock-checker').classList.remove('active'); }
    function openWindow() { document.getElementById('mainWindow').style.display = 'flex'; document.getElementById('dock-checker').classList.add('active'); }
    function handleFile(e) { const reader = new FileReader(); reader.onload = (e) => document.getElementById('linksInput').value = e.target.result; reader.readAsText(e.target.files[0]); }
    function copyValids() { navigator.clipboard.writeText(stats.validLinks.join('\n')); alert("Copiado!"); }
    function downloadValids() { const blob = new Blob([stats.validLinks.join('\n')], { type: 'text/plain' }); const url = URL.createObjectURL(blob); const a = document.createElement('a'); a.href = url; a.download = 'valid_nitro.txt'; a.click(); }
</script>
</body>
</html>
